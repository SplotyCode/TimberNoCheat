package me.david.timbernocheat.checkes.exploits;

import me.david.timbernocheat.TimberNoCheat;
import me.david.timbernocheat.checkbase.Category;
import me.david.timbernocheat.checkbase.Check;
import me.david.timbernocheat.checkbase.CheckManager;
import me.david.timbernocheat.checkbase.PlayerData;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.player.PlayerAnimationEvent;
import org.bukkit.event.player.PlayerItemHeldEvent;

public class Crasher extends Check {

    private final boolean switchitem;
    private final boolean swingitem;
    private final int swingspersecond;
    private final int switchspersecond;

    public Crasher(){
        super("Crasher", Category.EXPLOITS);
        swingitem = getBoolean("swingitem");
        switchitem = getBoolean("switchitem");
        swingspersecond = getInt("swingspersecond");
        switchspersecond = getInt("switchspersecond");
    }

    @EventHandler(priority = EventPriority.LOWEST)
    public void onItemswitch(PlayerItemHeldEvent event){
        final Player player = event.getPlayer();
        if(!CheckManager.getInstance().isvalid_create(player) || event.isCancelled() || !switchitem){
            return;
        }
        PlayerData pd = CheckManager.getInstance().getPlayerdata(player);
        pd.setItemSwitchesInOneSecond(pd.getItemSwitchesInOneSecond()+1);
        Bukkit.getScheduler().runTaskLater(TimberNoCheat.getInstance(), () -> pd.setItemSwitchesInOneSecond(pd.getItemSwitchesInOneSecond()-1), 20);
        if(pd.getItemSwitchesInOneSecond() > switchspersecond){
            if(updateVio(this, player, pd.getItemSwitchesInOneSecond()-switchspersecond, " §6CHECK: §bSWITCH")) event.setCancelled(true);
        }
    }
    @EventHandler(priority = EventPriority.LOWEST)
    public void onSwing(PlayerAnimationEvent e){
        final Player p = e.getPlayer();
        if(!CheckManager.getInstance().isvalid_create(p) || e.isCancelled() || !swingitem){
            return;
        }
        PlayerData pd = CheckManager.getInstance().getPlayerdata(p);
        pd.setItemSwungInOneSecond(pd.getItemSwungInOneSecond()+1);
        Bukkit.getScheduler().runTaskLater(TimberNoCheat.getInstance(), () -> pd.setItemSwungInOneSecond(pd.getItemSwungInOneSecond()-1), 20);
        if(pd.getItemSwungInOneSecond() > swingspersecond){
            if(updateVio(this, p, pd.getItemSwungInOneSecond()-swingspersecond, " §6CHECK: §bSWING")) e.setCancelled(true);
        }
    }
}
