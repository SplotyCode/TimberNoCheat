package me.david.TimberNoCheat.checkes.exploits;

import com.comphenix.protocol.events.PacketEvent;
import me.david.TimberNoCheat.TimberNoCheat;
import me.david.TimberNoCheat.checkmanager.Category;
import me.david.TimberNoCheat.checkmanager.Check;
import me.david.TimberNoCheat.checkmanager.PlayerData;

public class Packet_Flood extends Check {

    public Packet_Flood(){
        super("Packet_Flood", Category.EXPLOITS);
    }

    /*
    check is registet in NBT class
     */
    public static void check(PacketEvent e){
        PlayerData pd = TimberNoCheat.checkmanager.getPlayerdata(e.getPlayer());
        long delay = pd.getLastnbtpacket()-System.currentTimeMillis();
        if(delay < TimberNoCheat.instance.settings.exploit_nbtpacketfloor_toomany){
            TimberNoCheat.checkmanager.notify(TimberNoCheat.checkmanager.getCheckbyName("Packet_Flood"), e.getPlayer(), " §6DELAY: §b" + delay, " §6KICK: §b" + !TimberNoCheat.instance.settings.exploit_nbtpacketfloor_cmd.equals(""));
            TimberNoCheat.checkmanager.execute(TimberNoCheat.instance.settings.exploit_nbtpacketfloor_cmd, e.getPlayer().getName());
            e.setCancelled(true);
            return;
        }
        pd.setLastnbtpacket(System.currentTimeMillis());
    }
}
